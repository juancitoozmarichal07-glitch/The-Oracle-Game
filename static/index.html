<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>The Oracle Game</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#000000">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => console.log('[PWA] ServiceWorker registrado con Ã©xito:', registration.scope))
                    .catch(error => console.log('[PWA] Fallo en el registro de ServiceWorker:', error));
            });
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="arcade-screen">
        <!-- ======================== -->
        <!-- == PANTALLA DE TÃTULO == -->
        <!-- ======================== -->
        <div id="title-screen" class="screen">
            <div id="lightning-overlay"></div>
            <div id="intro-brain">ðŸ§ </div>
            <div id="title-layout" class="hidden">
                <div id="title-brain">ðŸ§ </div>
                <h1 id="game-title" data-text="THE ORACLE GAME">THE ORACLE GAME</h1>
                <div id="title-buttons">
                    <button id="start-button" class="button-green blink">JUGAR</button>
                    <button id="exit-button" class="button-red">SALIR</button>
                </div>
            </div>
        </div>

        <!-- ================================= -->
        <!-- == ESCENA DEL TELÃ“N Y MENÃšS    == -->
        <!-- ================================= -->
        <div id="game-stage" class="screen hidden">
           <div id="stage-lights">
                <div class="spotlight"></div>
                <div class="spotlight"></div>
            </div>
            <div id="stage-content-container">
                <div class="spotlight-container">
                    <div id="stage-brain">ðŸ§ </div>
                </div>
                <div id="stage-dialog"></div>
                <div id="menu-buttons"></div>
            </div>
            <div id="curtain-left" class="curtain"></div>
            <div id="curtain-right" class="curtain"></div>
        </div>

        <!-- ============================= -->
        <!-- == PANTALLA DE JUEGO PRINCIPAL == -->
        <!-- ============================= -->
        <div id="main-game-screen" class="screen hidden">
            <div class="game-header" id="game-header">
                <button id="back-to-menu-button" class="header-button">â€¹ MENÃš</button>
                <div id="timer" class="header-info">00:00</div>
                <div id="question-counter" class="header-info">0/20</div>
            </div>
            <div id="chat-history"></div>
            <div class="player-controls">
                <!-- Controles Modo OrÃ¡culo vs IA -->
                <div id="oracle-mode-controls">
                    <div class="input-area">
                        <input type="text" id="user-question-input" placeholder="Escribe tu pregunta...">
                        <button id="ask-button"><svg viewBox="0 0 24 24"><path d="M2,21L23,12L2,3V10L17,12L2,14V21Z" /></svg></button>
                    </div>
                    <div class="action-buttons">
                        <button id="suggestion-button" class="button-green">Sugerencia (5)</button>
                        <button id="guess-button" class="button-green">Â¡Adivinar!</button>
                    </div>
                </div>
                <!-- Controles Modo ClÃ¡sico vs IA -->
                <div id="classic-mode-controls" class="hidden">
                    <div class="classic-answer-buttons">
                        <button class="answer-btn" data-answer="SÃ­">SÃ­</button>
                        <button class="answer-btn" data-answer="No">No</button>
                        <button class="answer-btn" data-answer="No lo sÃ©">No lo sÃ©</button>
                        <button class="answer-btn" data-answer="Probablemente SÃ­">Prob. SÃ­</button>
                        <button class="answer-btn" data-answer="Probablemente No">Prob. No</button>
                    </div>
                </div>
                <!-- Controles para Duelo 1vs1 (cuando eres el OrÃ¡culo) -->
                <div id="duelo-oraculo-controls" class="hidden">
                    <div class="classic-answer-buttons">
                        <button class="answer-btn" data-answer="SÃ­">SÃ­</button>
                        <button class="answer-btn" data-answer="No">No</button>
                        <button class="answer-btn" data-answer="No lo sÃ©">No lo sÃ©</button>
                        <button class="answer-btn" data-answer="Probablemente SÃ­">Prob. SÃ­</button>
                        <button class="answer-btn" data-answer="Probablemente No">Prob. No</button>
                        <!-- BOTÃ“N PARA RESPUESTA PERSONALIZADA -->
                        <button id="custom-answer-button" class="answer-btn button-purple">Respuesta MÃ­stica âœ¨</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====================== -->
        <!-- == PANTALLAS FINALES == -->
        <!-- ====================== -->
        <div id="win-screen" class="end-screen screen hidden">
            <div class="end-screen-content">
                <h1>Â¡VICTORIA!</h1>
                <p id="win-message"></p>
                <div class="end-buttons">
                    <button class="end-screen-btn" data-action="play-again">Jugar de Nuevo</button>
                    <button class="end-screen-btn" data-action="main-menu">MenÃº Principal</button>
                </div>
            </div>
        </div>
        <div id="lose-screen" class="end-screen screen hidden">
            <div class="end-screen-content">
                <h1>DERROTA</h1>
                <p id="lose-message"></p>
                <div class="end-buttons">
                    <button class="end-screen-btn" data-action="play-again">Jugar de Nuevo</button>
                    <button class="end-screen-btn" data-action="main-menu">MenÃº Principal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================== -->
    <!-- == CONTENEDOR DE TODOS LOS POP-UPS == -->
    <!-- ================================== -->
    <div id="popups-container">
        <!-- Pop-up para Adivinar -->
        <div id="guess-popup" class="popup-overlay hidden">
            <div class="popup-content-guess">
                <div class="popup-header">
                    <div id="guess-popup-brain-icon">ðŸ§ </div>
                    <div id="guess-popup-dialog">
                        <p id="guess-popup-brain-text">Susurra tu respuesta al vacÃ­o...</p>
                    </div>
                </div>
                <div class="popup-body">
                    <h3 id="guess-popup-title">Tu Adivinanza Final</h3>
                    <p id="guess-popup-instruction">Escribe el nombre del ser que tÃº crees que estoy pensando.</p>
                    <input type="text" id="guess-input" placeholder="Escribe tu respuesta...">
                    <div class="popup-buttons">
                        <button id="confirm-guess-button" class="button-green">Confirmar</button>
                        <button data-close="guess-popup" class="button-red">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pop-up para Sugerencias -->
        <div id="suggestion-popup" class="popup-overlay hidden">
            <div class="popup-content">
                <h3>Sugerencias del Cerebro</h3>
                <div id="suggestion-buttons-container"></div>
                <div class="popup-buttons">
                    <button data-close="suggestion-popup" class="button-green">Cerrar</button>
                </div>
            </div>
        </div>

        <!-- Pop-up para Configurar Duelo 1 vs 1 -->
        <div id="duelo-config-popup" class="popup-overlay hidden">
            <div class="popup-content">
                <h3 id="duelo-config-title">Configurar Duelo 1 vs 1</h3>
                <div class="config-grid">
                    <!-- LÃ­mite de Preguntas -->
                    <label for="limite-preguntas-input">LÃ­mite de Preguntas:</label>
                    <div class="input-stepper">
                        <button class="stepper-btn" data-op="minus" data-target="limite-preguntas-input">-</button>
                        <input type="number" id="limite-preguntas-input" value="20" min="5" max="50" step="5">
                        <button class="stepper-btn" data-op="plus" data-target="limite-preguntas-input">+</button>
                    </div>
                    <!-- Intentos para Adivinar -->
                    <label for="intentos-adivinar-input">Intentos para Adivinar:</label>
                    <div class="input-stepper">
                        <button class="stepper-btn" data-op="minus" data-target="intentos-adivinar-input">-</button>
                        <input type="number" id="intentos-adivinar-input" value="3" min="1" max="10">
                        <button class="stepper-btn" data-op="plus" data-target="intentos-adivinar-input">+</button>
                    </div>
                </div>
                <h4 class="config-subtitle">Elige tu Rol:</h4>
                <div id="rol-selector" class="button-group">
                    <button class="rol-btn selected" data-rol="aleatorio">Aleatorio ðŸŽ²</button>
                    <button class="rol-btn" data-rol="oraculo">OrÃ¡culo ðŸ§ </button>
                    <button class="rol-btn" data-rol="adivino">Adivino ðŸ‘¤</button>
                </div>
                <div class="popup-buttons">
                    <button id="confirm-duelo-button" class="button-green">Crear Duelo y Link</button>
                    <button data-close="duelo-config-popup" class="button-red">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Pop-up para Respuesta Personalizada del OrÃ¡culo (NUEVO) -->
        <div id="custom-answer-popup" class="popup-overlay hidden">
            <div class="popup-content">
                <h3>Respuesta del OrÃ¡culo</h3>
                <p>Forja tu respuesta en el Ã©ter. SÃ© crÃ­ptico, sÃ© directo... el poder es tuyo.</p>
                <input type="text" id="custom-answer-input" placeholder="Escribe tu respuesta personalizada...">
                <div class="popup-buttons">
                    <button id="confirm-custom-answer-button" class="button-green">Enviar Respuesta</button>
                    <button data-close="custom-answer-popup" class="button-red">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
   <!-- Pop-up para AclaraciÃ³n de Respuesta (Modo ClÃ¡sico) -->
<div id="clarification-popup" class="popup-overlay hidden">
    <div class="popup-content">
        <h3>AÃ±adir AclaraciÃ³n (Opcional)</h3>
        <p>Tu respuesta base es: <strong id="clarification-base-answer"></strong></p>
        <input type="text" id="clarification-input" placeholder="Escribe tu aclaraciÃ³n aquÃ­...">
        <div class="popup-buttons">
            <button id="send-with-clarification" class="button-green">Enviar</button>
            <button id="send-without-clarification" class="button-grey">Enviar sin Aclarar</button>
        </div>
    </div>
</div>

    <!-- Script para la comunicaciÃ³n en tiempo real -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
    <!-- Nuestro script principal del juego -->
    <script src="script.js"></script>
</body>
</html>
